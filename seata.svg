<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2961px" height="3787px" viewBox="-0.5 -0.5 2961 3787" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-31T10:54:11.345Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.6.2 Chrome/83.0.4103.122 Electron/9.2.0 Safari/537.36&quot; etag=&quot;uj7Lj5Sub8D-tgUZzLrq&quot; version=&quot;13.6.2&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;ft8qHBVG7MIYmR1m9sZa&quot; name=&quot;第 1 页&quot;&gt;7V1Zc9s4Ev41rNp9sIv38UjqyGQn3mRiT2V2XqYoETomtOhQVGLPr19cJEGgJdESKcmx8zBDQyQIoK+vG92gZg3uH9/l8cPiJktQqpl68qhZQ83E/+wA/4+0PLEW3zVZwzxfJqzJqBtul/8g3qjz1s0yQevGjUWWpcXyodk4zVYrNC0abXGeZz+at82ytPnWh3iOlIbbaZyqrV+WSbHgszC9uv0XtJwvyjcbLp/wfVzezGeyXsRJ9kNoskaaNcizrGBX948DlJLFK9eFPTfe8ms1sBytijYPfP5bj93Nu9+dv6zf/vP11/Xiz2/FFe/le5xu+IT5YIuncgXybLNKEOnE0Kzox2JZoNuHeEp+/YFpjtsWxX3Kf47zKachnl80W6bpIEuznPZkIWvq6zpuXxd59hUJv0R64NBfZtmqENpn9B/pN13OV7gtRTM82UidezkRlBfoUWjia/EOZfeoyJ/wLfzXK9vihOGcadvszx81mc3A5fcsBBpbnu9yBuPMNa96r9cfX3ASwOSIvlg3Iyf8749i9uWfL8a75KMzuzL3kwMlmD/5n1leLLJ5torTUd0a1QQjK1rf8yHLHjiZ/kZF8cQJFW+KrEnErau7zjb5FO1gJz7cIs7nqNgxT94fmctOWuUojYvl96YsHrPqu0YtrPq7NJvE6V0er9bxtFhmK6wRsH7JNdNNCf9NyNWcXC1Xy2KQLslKjRzN97VgSC5CT/Mj2jLQApe2jLTQ1EYuuSfytJGnhZEWjg8QN0mq3MT3XBuSKit0bMtoL1VEeJZY9YW8uSD8Ioi01ZJN2gth0BRBo9SVggxaBiCC5XOds4KlsMLnG0bea0LpI5UjX9cp7g7zkkLJWHdMM4Eo6Q6N8U792AEtFGJ4KjECSB32RQtbocXdq6WFdTpagApbpcXFGqZdBmevYbLOZZh2jVpcdWJJxloUkIvI10KXmJRgoPmBYrPiVBtZmq9rvsF++5BNv5LbI0sLfW3kEysVWsQUBaHm2xMUr+jPnhYx2xVqoU7faGrBiL5xoEVh2asJ/YSfNejjNhleFAKjek8kbooeCiw5ozF5EBtJYhhHZEDMikYuHdaQvIi0OHTEDumctNjkXX41SEPoh76X3IOXxaPrIy/UjiWg97h0eXE/Iy0a04EFdGA+eRF5RfUuZvDZzQPSA74HPxJE5ZidfdPn712uvmMlI7ydjjBw6qV+YTChe2xget61czp0sEs7CPK4iFdJihQqY3So0bFZUcmbQYg1j3DL+9UsI/yCuT5iXD+mSFFlbZvwFLnAnGgQ6a8ZMCDsE9gUTbpU7DzyeCVGGGKK3IoZkwgrvZNxK8GptsDIuJ8hFRH1pRUnVlMzxakNNjkh9sd8kKO4QNVP0ByfJdAOmZpPoTMefFCJOMPZQy2g/eB23qFO+uQzoh3iyRLNVCkGehGGO1/hkm7DcSmROtRhpTNkfZBnWEpLBZjGm9V0gSEGmz6eHV8Hg2oLh64MHZjvQItsCSvpEn3M1AOePvYoWjEAvqDqhDkhrB8+O7xuOleNePxkBaoh4f/itaVPYX4gq63SSB2tXY12gubLlSgS4jKRC73pJ+1jiPodTmNFZOWMl9Kj1KXTIKxQ0YlSJAiFCQTkXWTVfKLtA/Et7s51V1ewIqpH6BGMy2ma3ABF/g5KTLP7e4xoufnwq3bMSekkxla7Hlfj8uUYBbOjqI1pOA2zYDsAMjYBo2AbfVkFR7EKCu9D5qDIl/M5yiM0y3IUkScEWfOI9HEBN7UwKHUdU0T0V8IjVN1BCnmIZvEmFe3NTbyK8euuJ+xNAu7CKo/ZAKrXmC2j4/mMvm3QmrIlwZwetRxGCfwYCvVJi6Sv8ShZz3jEoUPvwS0WF43QX6P8O8rrEEj5bNkuoSm7Ml2Nsa0fstUaQUOp4CnDlE4pnF75ArnfSkc8YkLXM/EJBaJRRY11ERebdaXZOc2qt1HYHBiVdNPOGJrVIX1KNTVBmB5RfUTX7dL+nF3CWUF4hnMLWenRM7nlWJ0x86doOoV0xsR3iDieCzBaZkMzOED8wjZdVTMYpUrpXDO4gP92pMUSHRWPukkOYRqC3UT7ykCQKEgNCSxFYCAwH/OOhk3gGRKLJUqE/JTac/VSekEcSGplA5PKAxOSoB0GZIjJLLHbSABKorph0E9d2JLla7PtkFcEbLRRaZIdapJd0s5hzpDPcetSCwuLHeAwGsZFfEtjEJ/y7PGp8rsHbFcKq99m+6ccEVZPbrFGQfeY5fnPDgHbQdgYX8QAnkuWhkM1n7NLdTOeOYMneJIMYYY2HbpHVYTbKWi4XAXQ9Bg9IJpsm/4J/cVgf9TswN01p1Ms1wUwswy3GbKEgvmG4UIKWO8tbmm02OC86MCl1zJwWaLbC4lcesqyyypS0EiKESHhhEpzqnBN1qrHa7QZcmGNlnjBhAb7YRXWheBgQblu+jSGYauiY/qAU+P0Jjf+C5ebUh72C453UYJTjltYeIXdK8l5YDCiQhFQAFmOW22HHls9OhlZoUc03RRoB74csTvu0P1DSoOBHEtVT6rjFL2uMXXa1Hvs7QEZhuO8Er5ZEB7kg1h/S8u3DDnG5K9rOMKNOCN3aRvTyPI9qxawKBeFvD6AUPlq5G2Wp7N9gAN03f0ySag8K5umnUO4K8OVUwIAXWh5DoQielOGaoLI+9Uaz2lU8sHzqaIs5TyPE7K3LRLE8awgAfKo3ERPEETCIHAN3+kITRsSJYwAAHQOFGrrjRDqBszvDwlWMD81IWw5GeACCKHmAwxRin5yQigSYQLB5xMTQg0+32JCTItxlr9G0bgAiqhBv09pvFz91HRwXePiVJTqgnJ4FWIyDOiG2zhO1+gskIpHwM6ApyyAMiCe6pE0alxsQnfB3t+TbPx+BCTwEt3zVOIlDvITMGzmmxPLdTuig2tde5KXb0MBMr8KBpwkr89U3c0tnlPE972x4+V7sAv1agjnXwDh1MBmTLYGX5cIOUBe7MkpoXqHPC7z+yrJPmTz10ONS5AL1TNJuLX/uQ29kjLuuio1fN+DqGH3ZupN1T95yLMpWq+VnMmDidSzsOzbvOwIQl+57rUpCZSnqySsaNUQp962ME3VncnRfLkuoGIoIQsuYBvdEabvdPGZP7E9oQjoSt71mdCu3ieNtE/8aFjnf9aRcnyF172AArQs/XPYE6PNZjGvZJRVxzQx/QNUR7cFV6Z9XRaoVkwGbTY5/nUZ9RT5zOuNzVRvbZZu1gtuQtcqg2zKX8pU+zq7442y3PQC6GgbZfuzAOpOItuTq4X1etqn6n+BdANc9G1066T6zvzl7rc/bx5+ye6+z6Pio/5tZLQpRe6uMvzo3BVlvQGqbK808ZrQyYUcc9sD7K7hmH2tv7rVwXN6B1mWJ8tVfFgs8YBcropwXpOiu1IijqKHYUqBdshEGSaU5W1U8a7OCQI5FkJC8vG0cGNdpyytCgEGgoPBDiE4DVWkUKIPiIkL1WOZXaTegzRRvYtKSHLEU91VaMlbslRuSZdlCyPsLfZTqH2iJU2NNqggaH9K65o/zN+H51y/Uh2EWoxZPi8WmWC0HQ35BcuDxVg4GPOgHctHJzUqLFc2oPdUSQpVuaZDsx/quk0+TV41ICTDtukVLNka8lx3niZcdaiieZ5vO8RLIhZZ7ngzHzTJMYviNZIHX+fVt1l2ic5yNFQuoBCqmciwxu1Sm6uqgT1FBvLb5NuhaqoqXzmgFzYfCCv9w3eSyYgp3VIC95G8xQmbrXiVApiSNOQ516RCRMywtrcVdjVIu8oYaYX6WZKOoYQUhh93ZhrR5HDfnctyrXqXtIZjGNXO4zNZSnWM2ybAy7St7rGp1nGVOY++E33edlhqJUybYYnVMnxx7m52vhM3iur2GCD5/EOFnpmN7nVlL33JXgJ70w6IKnvDMGowJ8maIZqzwpiW/la3MMYwdLWu/MQ4Ro1+TCSqHAJioNJrOXPykQTU5NuaFrA9WAmt8uSFcXX2wa0AWUoEgdVI5HJj5BsHo6FjTdUzdHcD6THaVBPbapvFasJCqPyvW+uYZqPh7ukBVU05YsnOwl1pNv36K3pat5xBY7zsEJBmybrPDsewS/QS8rIt3OIbzQmW+8G8yLy6RzgSBP/piz/RgiVeixhSkrhCSfmAlzDhlQ298mIIbUI/z+Q2rPp1nCRMz9WQsjFp1cbRITOO4jVjW+ks8YPC3yWWKwPnKGmkCTeZWupMrB+VIFxAeNJ3y/Rkv/Hk+gisAkfeZUGuebdN/8cCgJNY/a4tjS9bGiCOcWIEoEZjc/SQ5RVibLOZQ+5/1lYOS6RnqD4sC7L3SqBHlHUoHukTEFzOJItIoAMXfcra5vDU+csILx/FhEB4OXjGhk9vfKimgNVIlPDXvwi1Samwz/VtaDcKMmRvqqoaUSMaLmEZXn9BjrL59yvEuDawkwxi3P40D1DZNBEI3hXElbz55rlgga04++TcG6cEh5Fk6nadgtQaFKuVSg3VV9tR6tL7I2mIlRmXZ9oc66WDaJdWtFcnrMk4Zyto+rSI1+jjCv01zFaIozcOyKqVUR9WDyGR3/8GW1rDFhvYR4ZhS28OMlDHjf0iBGgN4nSZtWNlVs5StJnNiCc9UJ9Zf0tJosH7At2XtwF4u4q4euSIFcyDb4CCtejARtDJAQVQpFfuz3WV/te51e/F1LuAtMKm3u+NFurmdZnicZiRV6JWSyBqNT8wanUeeygHEeZgtIxEjL4jSBtx8zijJSziiZC+x12tgB5hyoMtenX8KezN1/GaQww6flMAT2CHZWcsUSxX82dE4rYc1BjeUSbxhV0T8QQ+AQUQVik3NUK71X5Hv5sp6pCeFSB9Qyhbcp1hhNJbvg5QEnsANcR9rm0HL+5MpLI91/dAE4VhnGN3Q4ArS8qYMi0IAhhgho7eyeH9YMqaoaz4Cc4oQY/L4g/h+n+kq2uH/zV85D3TP57KP1Z4vn+If7CndNcvG+oH6V+NJz+hfImXjCDIIXASvU7/VaSWTjbZ/2UPkL35Hpl4ngp8owuzTvef8gBZwD8nC2Cym5bABsa1Xv29jxGuDdcRmeEKc4PhdckN5MXyvefgEPOsHGKdVUnopMZDYJCDtITn7GELiQPG+N/Z9AHzRs5FbfvM+sA7gNpE8k2nSXIjMDpQBWdlhPMaBuCgDJKydAxAq4GYASCxiZEkMxBIG7pnBagjJCanSptgfT908oLRX+mAWoJzCqEr5QdbXd1uio/vdW5JmXzrut+AfZQTdsh4zybYbSuLzpGyyB/9lC1JsmFVSFGq25IZHd1u9sGmwB+T2KwaxxHq/rzGvcEKlrNb32/TzZfCI+eFabZ3OZR0rZYg3tC6wWmXwgKWdVaTrWar3g2OM9nP31LZtUHTgf2uC8h22W8wkBJ0UbIJS766Uw98FUI8wFfdboXy3Q+pk1A/PSGmLu794op4Gqd0Fjzu0OQBWP5ZsCq9pEo4okfzR/YBTNcqSAoyVxLQYwcUVp2ZW46ecCeu43bDjtXxabu40QyAIyR629cDTpA4rPZK+YxBHaine8avhMSGJWscG/hQhgF++Li3WldVwk4btTs6JHMBERnzZVh166wRmWaQ3mwZpYciMpZuXWhEpjUjnDlUr8K7z8dGZPZ81LfFaT+7zg7qQPteyRtnULaGCSnf/rI1gLNXtudp1C1Ddbd5vYgfyOX0KV1iquXmfpJNGH0/TKqGePp1Tqn+cVPgbhBvX/NQm9OCzmSn1AdxveVagZV0REvHuS53E6qPlAK51dCHG/qDS8A3Z9p8tkkmJT09qUGp5lquSDZmc+F5k0KcrcfJQ6zR1PS7teVx1FO/u2FCB9iBR6P2BoRUz+vn14mGpBMt6MtBJ9aJ5bfk3sRo7waE1RQiSzfOLES2ehLti0CYVgUouU9hdbFp0QfCtKwXgTAtNQ31FWhTXUKY0LEDp9amUAznTZtC4WCJdkD47bSABPiE6Ztv0IKQhi8fj2wG0IG8p/QNrDdH7zBiSunGlgk47aelJPAFhWOPcXmZ4WxLNncu4IEHvZ1BDgNQyHkAtyz21sBv3bKoC9xeCaHVfQsXOm7+pPsWdouc/xO4HidA/HZbxM+CiWfLGlERv3qgGz85WjhbZceHwrd+BHPLR1HKPjvxMriESvI2nSJnSxliafR6Kzd0zaYMetD3tgzgG9u9JSvYKkKVTOGInhniO8Ixg+yQEFf4njxPAvi8WRXYmx49TtFD0TxAgDGJLXxhdHu+QPnU3Q2tqxvwH0O3PBCpwUp5lqYEDfFkiYi5QiOS2/BatLuteK0AWLYhjHWAcsd/5llWiKmHeO0WN1mCyB3/Bw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-e6d0de-1-d5739d-1-s-0"><stop offset="0%" style="stop-color:#e6d0de"/><stop offset="100%" style="stop-color:#d5739d"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-d5e8d4-1-97d077-1-s-0"><stop offset="0%" style="stop-color:#d5e8d4"/><stop offset="100%" style="stop-color:#97d077"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffcd28-1-ffa500-1-s-0"><stop offset="0%" style="stop-color:#ffcd28"/><stop offset="100%" style="stop-color:#ffa500"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-fff2cc-1-ffd966-1-s-0"><stop offset="0%" style="stop-color:#fff2cc"/><stop offset="100%" style="stop-color:#ffd966"/></linearGradient></defs><g><rect x="0" y="0" width="2960" height="3786" rx="59.2" ry="59.2" fill="#e3c800" stroke="#b09500" pointer-events="all"/><path d="M 675 166 L 675 227.13" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 675 232.38 L 671.5 225.38 L 675 227.13 L 678.5 225.38 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="520" y="76" width="310" height="90" rx="2.7" ry="2.7" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 83px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">GlobalTransactionScanner<br />initClient初始化客户端</div></div></div></foreignObject><text x="522" y="95" fill="#ffffff" font-family="Helvetica" font-size="12px">GlobalTransactionScanner...</text></switch></g><rect x="720" y="126" width="90" height="30" rx="4.5" ry="4.5" fill="#a0522d" stroke="#6d1f00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 141px; margin-left: 721px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">RMClient.init</div></div></div></foreignObject><text x="765" y="145" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">RMClient.init</text></switch></g><rect x="720" y="86" width="90" height="30" rx="4.5" ry="4.5" fill="#a0522d" stroke="#6d1f00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 101px; margin-left: 721px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">TMClient.init</div></div></div></foreignObject><text x="765" y="105" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">TMClient.init</text></switch></g><path d="M 675 323.5 L 675 399.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 675 404.88 L 671.5 397.88 L 675 399.63 L 678.5 397.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="520" y="233.5" width="310" height="90" rx="2.7" ry="2.7" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 241px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">对带有GlobalTransactional、GlobalLock注解的bean添加增强。增强类为GlobalTransactionalInterceptor，控制着全局事务，一旦带有注解的方便执行，则会进入GlobalTransactionalInterceptor的invoke方法。</div></div></div></foreignObject><text x="522" y="253" fill="#ffffff" font-family="Helvetica" font-size="12px">对带有GlobalTransactional、GlobalLock注解的bean添加增强。增强类为GlobalTransactiona...</text></switch></g><rect x="215" y="406" width="920" height="410" rx="8.2" ry="8.2" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 918px; height: 1px; padding-top: 413px; margin-left: 217px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">handleGlobalTransaction<br />1：getTransactionInfo获取事务信息，隔离级别，回滚规则等信息。<br />2：getCurrentOrCreate：获取全局事务，如果不存在就创建一个，如果是新创建的，则role为launcher及发起者。<br />3：根据隔离级别决定是否挂起当前事务。<br />4：beginTransaction，开始全局事务<br />5：执行自己的业务逻辑<br />6：根据是否发生异常决定是commit还是rollback<div><br /></div><div><br /></div></div></div></div></foreignObject><text x="217" y="425" fill="#ffffff" font-family="Helvetica" font-size="12px">handleGlobalTransaction...</text></switch></g><rect x="462" y="526" width="426" height="115" rx="3.45" ry="3.45" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 424px; height: 1px; padding-top: 533px; margin-left: 464px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">beginTransaction<br />1：triggerBeforeBegin前置钩子函数<br />2：DefaultTransactionManager.begin，构建GlobalBeginRequest请求对象，同步调用server端，server会返回GlobalBeginResponse对象。接受server返回的xid，设置status为Begin。绑定xid到当前线程。<br />3：triggerAfterBegin后置钩子函数</div></div></div></foreignObject><text x="464" y="545" fill="#000000" font-family="Helvetica" font-size="12px">beginTransaction...</text></switch></g><rect x="460" y="676" width="428" height="90" rx="2.7" ry="2.7" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 426px; height: 1px; padding-top: 683px; margin-left: 462px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">执行自己的业务的时候，就会调用远程服务了，远程调用会传递xid给全局事务参与者，在执行数据库相关操作的时候会被DataSourceProxy、ConnectionProxy、PreparedStatementProxy做相应拦截做特殊处理<div><br /></div></div></div></div></foreignObject><text x="462" y="695" fill="#000000" font-family="Helvetica" font-size="12px">执行自己的业务的时候，就会调用远程服务了，远程调用会传递xid给全局事务参与者，在执行数据库相关操作的时候会被DataSourceProxy、ConnectionProxy、PreparedStatementProxy做相应拦截做特殊处理&#xa;</text></switch></g><rect x="114" y="1076" width="1166" height="1030" rx="51.5" ry="51.5" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><path d="M 457.5 1146 L 457.5 1189.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 457.5 1194.88 L 454 1187.88 L 457.5 1189.63 L 461 1187.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="317.5" y="1096" width="280" height="50" rx="7.5" ry="7.5" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 1103px; margin-left: 319px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DataSourceProxy<br />调用getConnection返回ConnectionProxy</div></div></div></foreignObject><text x="458" y="1115" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DataSourceProxy...</text></switch></g><path d="M 457.5 1296 L 457.5 1339.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 457.5 1344.88 L 454 1337.88 L 457.5 1339.63 L 461 1337.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="270" y="1196" width="375" height="100" rx="3" ry="3" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 373px; height: 1px; padding-top: 1246px; margin-left: 271px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ConnectionProxy<br />prepareStatement方法创建PreparedStatementProxy对象，执行execute会调用ExecuteTemplate的execute方法，该方法会根据具体执行的sql语句构建不同的executor对象，最终执行executer的execute方法。</div></div></div></foreignObject><text x="458" y="1250" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">ConnectionProxy...</text></switch></g><rect x="740" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 741px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">InsertExecutor</div></div></div></foreignObject><text x="815" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">InsertExecutor</text></switch></g><rect x="920" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 921px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">UpdateExecutor</div></div></div></foreignObject><text x="995" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">UpdateExecutor</text></switch></g><rect x="740" y="1206" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1226px; margin-left: 741px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DeleteExecutor</div></div></div></foreignObject><text x="815" y="1230" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DeleteExecutor</text></switch></g><rect x="920" y="1206" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1226px; margin-left: 921px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">SelectForUpdateExecutor</div></div></div></foreignObject><text x="995" y="1230" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">SelectForUpdateExecutor</text></switch></g><rect x="1091" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 1092px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">PlainExecutor</div></div></div></foreignObject><text x="1166" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">PlainExecutor</text></switch></g><rect x="270" y="1346" width="375" height="240" rx="7.2" ry="7.2" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 373px; height: 1px; padding-top: 1353px; margin-left: 271px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">executeAutoCommitFalse</div></div></div></foreignObject><text x="458" y="1365" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">executeAutoCommitFalse</text></switch></g><rect x="366.25" y="1376" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1391px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">beforeImage</div></div></div></foreignObject><text x="458" y="1395" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">beforeImage</text></switch></g><rect x="366.25" y="1436" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1451px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">执行目标sql语句</div></div></div></foreignObject><text x="458" y="1455" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">执行目标sql语句</text></switch></g><rect x="366.25" y="1486" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1501px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">afterImage</div></div></div></foreignObject><text x="458" y="1505" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">afterImage</text></switch></g><rect x="366.25" y="1536" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1551px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">prepareUndoLog</div></div></div></foreignObject><text x="458" y="1555" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">prepareUndoLog</text></switch></g><rect x="140" y="1616" width="887.5" height="440" rx="13.2" ry="13.2" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 886px; height: 1px; padding-top: 1623px; margin-left: 141px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doCommit</div></div></div></foreignObject><text x="584" y="1635" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">doCommit</text></switch></g><rect x="363.75" y="1656" width="440" height="390" rx="19.5" ry="19.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 438px; height: 1px; padding-top: 1663px; margin-left: 365px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">processGlobalTransactionCommit</div></div></div></foreignObject><text x="584" y="1675" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">processGlobalTransactionCommit</text></switch></g><rect x="454.69" y="1696" width="258.12" height="70" rx="10.5" ry="10.5" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1703px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">register<br />发送BranchRegisterRequest请求<br />返回branchId存储在ConnectionContext对象中</div></div></div></foreignObject><text x="584" y="1715" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">register...</text></switch></g><rect x="454.69" y="1786" width="258.12" height="40" rx="6" ry="6" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1793px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">flushUndoLogs<br />undoLogs入库</div></div></div></foreignObject><text x="584" y="1805" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">flushUndoLogs...</text></switch></g><rect x="454.69" y="1846" width="258.12" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1853px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">targetConnection.commit</div></div></div></foreignObject><text x="584" y="1865" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">targetConnection.commit</text></switch></g><rect x="1400" y="576" width="1470" height="1520" rx="29.4" ry="29.4" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><rect x="1640" y="696" width="1220" height="1160" rx="81.2" ry="81.2" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1218px; height: 1px; padding-top: 703px; margin-left: 1641px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DefaultCoordinator</div></div></div></foreignObject><text x="2250" y="715" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DefaultCoordinator</text></switch></g><rect x="1690" y="776" width="610" height="210" rx="31.5" ry="31.5" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 783px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doGlobalBegin</div></div></div></foreignObject><text x="1995" y="795" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doGlobalBegin</text></switch></g><rect x="1710" y="806" width="570" height="160" rx="11.2" ry="11.2" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 813px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DefaultCore.begin<br /><ol><li>GlobalSession.createGlobalSession创建全局事务session</li><li>添加session生命周期监听器，类型为SessionManager的监听器，如果使用的存储时DB,则监听器为DataBaseSessionManager。</li><li>GlobalSession执行begin，开启全局事务。设置status为begin，设置开始时间属性，调用生命周期监听器的onBegin方法即此时会执行DataBaseSessinoManage的insertGlobalTransactionDO方法，将globalSession存储到DB中。</li><li>发送全局事务开始事件GlobalTransactionEvent</li><li>返回全局事务的xid到TM</li></ol></div></div></div></foreignObject><text x="1712" y="825" fill="#000000" font-family="Helvetica" font-size="12px">DefaultCore.begin...</text></switch></g><rect x="1690" y="1061" width="610" height="210" rx="31.5" ry="31.5" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1068px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doBranchRegister</div></div></div></foreignObject><text x="1995" y="1080" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doBranchRegister</text></switch></g><rect x="1710" y="1096" width="570" height="160" rx="11.2" ry="11.2" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1103px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchRegister<br /><ol><li>获取根据xId获取GlobalSession</li><li>检查GlobalSession的状态</li><li>添加生命周期监听器</li><li>创建branchSession，设置xid，transactionId，branchId，branchType，resourceId，lockKeys</li><li>branchSessionLock，分支加锁，行级锁。假锁成功才会继续执行。</li><li>globalSession.addBranch,分支事务落库，设置branchSession状态为registered，添加branchSession到属性集合branchSessions中。</li><li>返回branchSession的branchId。</li></ol></div></div></div></foreignObject><text x="1712" y="1115" fill="#000000" font-family="Helvetica" font-size="12px">branchRegister...</text></switch></g><rect x="454.69" y="1896" width="258.12" height="60" rx="9" ry="9" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1903px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">report<br />发送BranchReportRequest请求<br />上报分支事务第一阶段执行成功。</div></div></div></foreignObject><text x="584" y="1915" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">report...</text></switch></g><rect x="1690" y="1356" width="610" height="160" rx="24" ry="24" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1363px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doBranchReport(默认不发送该类型消息)</div></div></div></foreignObject><text x="1995" y="1375" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doBranchReport(默认不发送该类型消息)</text></switch></g><rect x="1710" y="1386" width="570" height="110" rx="7.7" ry="7.7" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1393px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchReport<br /><ol><li>获取globalSession，且globalSession包含branchSession信息。</li><li>根据分支branchId从globalSession中获取branchSession</li><li>添加生命周期监听器</li><li>更新branchSession状态为PhaseOne_Done,库中状态同步更新。</li></ol></div></div></div></foreignObject><text x="1712" y="1405" fill="#000000" font-family="Helvetica" font-size="12px">branchReport...</text></switch></g><rect x="454.69" y="1976" width="258.12" height="60" rx="9" ry="9" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1983px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">reset<br />xid,branchId,lockKeysBuffer,<br />sqlUndoItemsBuffer属性置空</div></div></div></foreignObject><text x="584" y="1995" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">reset...</text></switch></g><rect x="1690" y="1586" width="610" height="180" rx="27" ry="27" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1593px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doGlobalCommit</div></div></div></foreignObject><text x="1995" y="1605" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doGlobalCommit</text></switch></g><rect x="1710" y="1616" width="570" height="120" rx="8.4" ry="8.4" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1623px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">commit<br /><ol><li>根据xid获取globalSession</li><li>添加生命周期监听器</li><li>设置globalSession的active属性为false，释放所有branchSession的锁</li><li>更改globalSession的状态为committing</li><li>如果是AT模式异步提交全局事务</li><li>返回全局事务提交状态</li></ol></div></div></div></foreignObject><text x="1712" y="1635" fill="#000000" font-family="Helvetica" font-size="12px">commit...</text></switch></g><rect x="60" y="2276" width="2120" height="1090" rx="21.8" ry="21.8" fill="#647687" stroke="#314354" pointer-events="all"/><path d="M 570 2411 L 1260 2411 L 1260 2409.9 L 1943.63 2409.92" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1948.88 2409.92 L 1941.88 2413.42 L 1943.63 2409.92 L 1941.88 2406.42 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 403.05 2478.99 L 403.1 2530.97 L 402.9 2530.97 L 402.9 2576.57" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 402.9 2581.82 L 399.4 2574.82 L 402.9 2576.57 L 406.4 2574.82 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 307.5 2476 L 307.5 3211 L 593.63 3211" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 598.88 3211 L 591.88 3214.5 L 593.63 3211 L 591.88 3207.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 482.5 2476 L 482.5 2525.5 L 1940.63 2525.54" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1945.88 2525.54 L 1938.88 2529.04 L 1940.63 2525.54 L 1938.88 2522.04 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="220" y="2346" width="350" height="130" rx="15.6" ry="15.6" fill="#b1ddf0" stroke="#10739e" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 2411px; margin-left: 221px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">TM</div></div></div></foreignObject><text x="395" y="2415" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">TM</text></switch></g><path d="M 1950.96 2458.8 L 1260 2458.8 L 1260 2460 L 577.77 2460.01" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 572.52 2460.01 L 579.52 2456.51 L 577.77 2460.01 L 579.52 2463.51 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1950 2675.94 L 1285 2675.9 L 1285 2676 L 626.37 2676" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 621.12 2676 L 628.12 2672.5 L 626.37 2676 L 628.12 2679.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1950 2941.02 L 796.37 2941" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 791.12 2941 L 798.12 2937.5 L 796.37 2941 L 798.12 2944.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="1950" y="2346" width="120" height="940" rx="18" ry="18" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 2816px; margin-left: 1951px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">TC</div></div></div></foreignObject><text x="2010" y="2820" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">TC</text></switch></g><rect x="680" y="2346" width="295" height="60" rx="9" ry="9" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 293px; height: 1px; padding-top: 2353px; margin-left: 682px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">GlobalBeginRequest<br />同步发送开启全局事务请求，发生异常，数据没有不一致</div></div></div></foreignObject><text x="682" y="2365" fill="#000000" font-family="Helvetica" font-size="12px">GlobalBeginRequest...</text></switch></g><rect x="1750" y="2426" width="160" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 158px; height: 1px; padding-top: 2433px; margin-left: 1752px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">创建全局事务，返回xid</div></div></div></foreignObject><text x="1752" y="2445" fill="#000000" font-family="Helvetica" font-size="12px">创建全局事务，返回xid</text></switch></g><path d="M 490 2766 L 490 2896 L 523.63 2896" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 528.88 2896 L 521.88 2899.5 L 523.63 2896 L 521.88 2892.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 620 2631 L 1285 2631 L 1285 2630.8 L 1940.63 2630.82" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1945.88 2630.82 L 1938.88 2634.32 L 1940.63 2630.82 L 1938.88 2627.32 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="2586" width="260" height="180" rx="27" ry="27" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 258px; height: 1px; padding-top: 2676px; margin-left: 361px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">RM</div></div></div></foreignObject><text x="490" y="2680" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">RM</text></switch></g><path d="M 374.69 2711 C 374.69 2702.72 392.6 2696 414.69 2696 C 425.3 2696 435.47 2697.58 442.97 2700.39 C 450.48 2703.21 454.69 2707.02 454.69 2711 L 454.69 2741 C 454.69 2749.28 436.78 2756 414.69 2756 C 392.6 2756 374.69 2749.28 374.69 2741 Z" fill="#ffff88" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><path d="M 454.69 2711 C 454.69 2719.28 436.78 2726 414.69 2726 C 392.6 2726 374.69 2719.28 374.69 2711" fill="none" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 2726px; margin-left: 376px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><br /><br />DB</div></div></div></foreignObject><text x="415" y="2730" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DB...</text></switch></g><rect x="317.5" y="2536" width="75" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 73px; height: 1px; padding-top: 2546px; margin-left: 319px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFF00; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">远程调用</div></div></div></foreignObject><text x="355" y="2550" fill="#FFFF00" font-family="Helvetica" font-size="12px" text-anchor="middle">远程调用</text></switch></g><rect x="600" y="3076" width="260" height="180" rx="27" ry="27" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 258px; height: 1px; padding-top: 3166px; margin-left: 601px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">RM</div></div></div></foreignObject><text x="730" y="3170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">RM</text></switch></g><rect x="195" y="2966" width="75" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 73px; height: 1px; padding-top: 2976px; margin-left: 196px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFF00; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">远程调用</div></div></div></foreignObject><text x="233" y="2980" fill="#FFFF00" font-family="Helvetica" font-size="12px" text-anchor="middle">远程调用</text></switch></g><path d="M 790 2851 L 1370 2851 L 1370 2850.8 L 1939.67 2850.78" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1944.92 2850.78 L 1937.92 2854.28 L 1939.67 2850.78 L 1937.92 2847.28 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="530" y="2806" width="260" height="180" rx="27" ry="27" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 258px; height: 1px; padding-top: 2896px; margin-left: 531px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">RM</div></div></div></foreignObject><text x="660" y="2900" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">RM</text></switch></g><rect x="445" y="2846" width="75" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 73px; height: 1px; padding-top: 2856px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFF00; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">远程调用</div></div></div></foreignObject><text x="483" y="2860" fill="#FFFF00" font-family="Helvetica" font-size="12px" text-anchor="middle">远程调用</text></switch></g><path d="M 548.75 2931 C 548.75 2922.72 566.66 2916 588.75 2916 C 599.36 2916 609.53 2917.58 617.03 2920.39 C 624.54 2923.21 628.75 2927.02 628.75 2931 L 628.75 2961 C 628.75 2969.28 610.84 2976 588.75 2976 C 566.66 2976 548.75 2969.28 548.75 2961 Z" fill="#ffff88" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><path d="M 628.75 2931 C 628.75 2939.28 610.84 2946 588.75 2946 C 566.66 2946 548.75 2939.28 548.75 2931" fill="none" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 2946px; margin-left: 550px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><br /><br />DB</div></div></div></foreignObject><text x="589" y="2950" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DB...</text></switch></g><path d="M 610 3201 C 610 3192.72 627.91 3186 650 3186 C 660.61 3186 670.78 3187.58 678.28 3190.39 C 685.79 3193.21 690 3197.02 690 3201 L 690 3231 C 690 3239.28 672.09 3246 650 3246 C 627.91 3246 610 3239.28 610 3231 Z" fill="#ffff88" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><path d="M 690 3201 C 690 3209.28 672.09 3216 650 3216 C 627.91 3216 610 3209.28 610 3201" fill="none" stroke="#36393d" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 3216px; margin-left: 611px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><br /><br />DB</div></div></div></foreignObject><text x="650" y="3220" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DB...</text></switch></g><rect x="730" y="2596" width="92.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 91px; height: 1px; padding-top: 2603px; margin-left: 732px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchRegister</div></div></div></foreignObject><text x="732" y="2615" fill="#000000" font-family="Helvetica" font-size="12px">branchRegister</text></switch></g><rect x="1750" y="2636" width="160" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 158px; height: 1px; padding-top: 2643px; margin-left: 1752px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">创建分支事务，返回branchId</div></div></div></foreignObject><text x="1752" y="2655" fill="#000000" font-family="Helvetica" font-size="12px">创建分支事务，返回branchId</text></switch></g><path d="M 492 2726 L 472 2726 L 474.7 2726 L 461.06 2726" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 455.81 2726 L 462.81 2722.5 L 461.06 2726 L 462.81 2729.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="492" y="2706" width="118" height="40" rx="6" ry="6" fill="#cce5ff" stroke="#36393d" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 116px; height: 1px; padding-top: 2713px; margin-left: 494px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">存储undoLog到数据库，执行目标sql到</div></div></div></foreignObject><text x="494" y="2725" fill="#000000" font-family="Helvetica" font-size="12px">存储undoLog到数据库，执行目标sql到</text></switch></g><rect x="830" y="2816" width="480" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 478px; height: 1px; padding-top: 2823px; margin-left: 832px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchRegister超时或者有RuntimeException，整体不一致，TM需要执行rollback逻辑</div></div></div></foreignObject><text x="832" y="2835" fill="#000000" font-family="Helvetica" font-size="12px">branchRegister超时或者有RuntimeException，整体不一致，TM需要执行rollback逻辑</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>