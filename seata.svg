<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2961px" height="2177px" viewBox="-0.5 -0.5 2961 2177" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2020-08-31T09:49:38.299Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.6.2 Chrome/83.0.4103.122 Electron/9.2.0 Safari/537.36&quot; etag=&quot;ozofJiaCTFaowfkGeG9N&quot; version=&quot;13.6.2&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;ft8qHBVG7MIYmR1m9sZa&quot; name=&quot;第 1 页&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-e6d0de-1-d5739d-1-s-0"><stop offset="0%" style="stop-color:#e6d0de"/><stop offset="100%" style="stop-color:#d5739d"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-d5e8d4-1-97d077-1-s-0"><stop offset="0%" style="stop-color:#d5e8d4"/><stop offset="100%" style="stop-color:#97d077"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffcd28-1-ffa500-1-s-0"><stop offset="0%" style="stop-color:#ffcd28"/><stop offset="100%" style="stop-color:#ffa500"/></linearGradient></defs><g><rect x="0" y="0" width="2960" height="2176" rx="43.52" ry="43.52" fill="#e3c800" stroke="#b09500" pointer-events="all"/><path d="M 675 166 L 675 227.13" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 675 232.38 L 671.5 225.38 L 675 227.13 L 678.5 225.38 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="520" y="76" width="310" height="90" rx="2.7" ry="2.7" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 83px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">GlobalTransactionScanner<br />initClient初始化客户端</div></div></div></foreignObject><text x="522" y="95" fill="#ffffff" font-family="Helvetica" font-size="12px">GlobalTransactionScanner...</text></switch></g><rect x="720" y="126" width="90" height="30" rx="4.5" ry="4.5" fill="#a0522d" stroke="#6d1f00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 141px; margin-left: 721px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">RMClient.init</div></div></div></foreignObject><text x="765" y="145" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">RMClient.init</text></switch></g><rect x="720" y="86" width="90" height="30" rx="4.5" ry="4.5" fill="#a0522d" stroke="#6d1f00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 101px; margin-left: 721px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">TMClient.init</div></div></div></foreignObject><text x="765" y="105" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">TMClient.init</text></switch></g><path d="M 675 323.5 L 675 399.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 675 404.88 L 671.5 397.88 L 675 399.63 L 678.5 397.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="520" y="233.5" width="310" height="90" rx="2.7" ry="2.7" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 241px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">对带有GlobalTransactional、GlobalLock注解的bean添加增强。增强类为GlobalTransactionalInterceptor，控制着全局事务，一旦带有注解的方便执行，则会进入GlobalTransactionalInterceptor的invoke方法。</div></div></div></foreignObject><text x="522" y="253" fill="#ffffff" font-family="Helvetica" font-size="12px">对带有GlobalTransactional、GlobalLock注解的bean添加增强。增强类为GlobalTransactiona...</text></switch></g><rect x="215" y="406" width="920" height="410" rx="8.2" ry="8.2" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 918px; height: 1px; padding-top: 413px; margin-left: 217px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">handleGlobalTransaction<br />1：getTransactionInfo获取事务信息，隔离级别，回滚规则等信息。<br />2：getCurrentOrCreate：获取全局事务，如果不存在就创建一个，如果是新创建的，则role为launcher及发起者。<br />3：根据隔离级别决定是否挂起当前事务。<br />4：beginTransaction，开始全局事务<br />5：执行自己的业务逻辑<br />6：根据是否发生异常决定是commit还是rollback<div><br /></div><div><br /></div></div></div></div></foreignObject><text x="217" y="425" fill="#ffffff" font-family="Helvetica" font-size="12px">handleGlobalTransaction...</text></switch></g><rect x="462" y="526" width="426" height="115" rx="3.45" ry="3.45" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 424px; height: 1px; padding-top: 533px; margin-left: 464px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">beginTransaction<br />1：triggerBeforeBegin前置钩子函数<br />2：DefaultTransactionManager.begin，构建GlobalBeginRequest请求对象，同步调用server端，server会返回GlobalBeginResponse对象。接受server返回的xid，设置status为Begin。绑定xid到当前线程。<br />3：triggerAfterBegin后置钩子函数</div></div></div></foreignObject><text x="464" y="545" fill="#000000" font-family="Helvetica" font-size="12px">beginTransaction...</text></switch></g><rect x="460" y="676" width="428" height="90" rx="2.7" ry="2.7" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 426px; height: 1px; padding-top: 683px; margin-left: 462px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">执行自己的业务的时候，就会调用远程服务了，远程调用会传递xid给全局事务参与者，在执行数据库相关操作的时候会被DataSourceProxy、ConnectionProxy、PreparedStatementProxy做相应拦截做特殊处理<div><br /></div></div></div></div></foreignObject><text x="462" y="695" fill="#000000" font-family="Helvetica" font-size="12px">执行自己的业务的时候，就会调用远程服务了，远程调用会传递xid给全局事务参与者，在执行数据库相关操作的时候会被DataSourceProxy、ConnectionProxy、PreparedStatementProxy做相应拦截做特殊处理&#xa;</text></switch></g><rect x="114" y="1076" width="1166" height="1030" rx="51.5" ry="51.5" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><path d="M 457.5 1146 L 457.5 1189.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 457.5 1194.88 L 454 1187.88 L 457.5 1189.63 L 461 1187.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="317.5" y="1096" width="280" height="50" rx="7.5" ry="7.5" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 1103px; margin-left: 319px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DataSourceProxy<br />调用getConnection返回ConnectionProxy</div></div></div></foreignObject><text x="458" y="1115" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DataSourceProxy...</text></switch></g><path d="M 457.5 1296 L 457.5 1339.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 457.5 1344.88 L 454 1337.88 L 457.5 1339.63 L 461 1337.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="270" y="1196" width="375" height="100" rx="3" ry="3" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 373px; height: 1px; padding-top: 1246px; margin-left: 271px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ConnectionProxy<br />prepareStatement方法创建PreparedStatementProxy对象，执行execute会调用ExecuteTemplate的execute方法，该方法会根据具体执行的sql语句构建不同的executor对象，最终执行executer的execute方法。</div></div></div></foreignObject><text x="458" y="1250" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">ConnectionProxy...</text></switch></g><rect x="740" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 741px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">InsertExecutor</div></div></div></foreignObject><text x="815" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">InsertExecutor</text></switch></g><rect x="920" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 921px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">UpdateExecutor</div></div></div></foreignObject><text x="995" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">UpdateExecutor</text></switch></g><rect x="740" y="1206" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1226px; margin-left: 741px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DeleteExecutor</div></div></div></foreignObject><text x="815" y="1230" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DeleteExecutor</text></switch></g><rect x="920" y="1206" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1226px; margin-left: 921px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">SelectForUpdateExecutor</div></div></div></foreignObject><text x="995" y="1230" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">SelectForUpdateExecutor</text></switch></g><rect x="1091" y="1146" width="150" height="40" rx="6" ry="6" fill="url(#mx-gradient-e6d0de-1-d5739d-1-s-0)" stroke="#996185" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1166px; margin-left: 1092px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">PlainExecutor</div></div></div></foreignObject><text x="1166" y="1170" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">PlainExecutor</text></switch></g><rect x="270" y="1346" width="375" height="240" rx="7.2" ry="7.2" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 373px; height: 1px; padding-top: 1353px; margin-left: 271px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">executeAutoCommitFalse</div></div></div></foreignObject><text x="458" y="1365" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">executeAutoCommitFalse</text></switch></g><rect x="366.25" y="1376" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1391px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">beforeImage</div></div></div></foreignObject><text x="458" y="1395" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">beforeImage</text></switch></g><rect x="366.25" y="1436" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1451px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">执行目标sql语句</div></div></div></foreignObject><text x="458" y="1455" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">执行目标sql语句</text></switch></g><rect x="366.25" y="1486" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1501px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">afterImage</div></div></div></foreignObject><text x="458" y="1505" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">afterImage</text></switch></g><rect x="366.25" y="1536" width="182.5" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 181px; height: 1px; padding-top: 1551px; margin-left: 367px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">prepareUndoLog</div></div></div></foreignObject><text x="458" y="1555" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">prepareUndoLog</text></switch></g><rect x="140" y="1616" width="887.5" height="440" rx="13.2" ry="13.2" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 886px; height: 1px; padding-top: 1623px; margin-left: 141px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doCommit</div></div></div></foreignObject><text x="584" y="1635" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">doCommit</text></switch></g><rect x="363.75" y="1656" width="440" height="390" rx="19.5" ry="19.5" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 438px; height: 1px; padding-top: 1663px; margin-left: 365px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">processGlobalTransactionCommit</div></div></div></foreignObject><text x="584" y="1675" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">processGlobalTransactionCommit</text></switch></g><rect x="454.69" y="1696" width="258.12" height="70" rx="10.5" ry="10.5" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1703px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">register<br />发送BranchRegisterRequest请求<br />返回branchId存储在ConnectionContext对象中</div></div></div></foreignObject><text x="584" y="1715" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">register...</text></switch></g><rect x="454.69" y="1786" width="258.12" height="40" rx="6" ry="6" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1793px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">flushUndoLogs<br />undoLogs入库</div></div></div></foreignObject><text x="584" y="1805" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">flushUndoLogs...</text></switch></g><rect x="454.69" y="1846" width="258.12" height="30" rx="4.5" ry="4.5" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1853px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">targetConnection.commit</div></div></div></foreignObject><text x="584" y="1865" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">targetConnection.commit</text></switch></g><rect x="1400" y="576" width="1470" height="1520" rx="29.4" ry="29.4" fill="#6d8764" stroke="#3a5431" pointer-events="all"/><rect x="1640" y="696" width="1220" height="1160" rx="81.2" ry="81.2" fill="#f8cecc" stroke="#b85450" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1218px; height: 1px; padding-top: 703px; margin-left: 1641px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DefaultCoordinator</div></div></div></foreignObject><text x="2250" y="715" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DefaultCoordinator</text></switch></g><rect x="1690" y="776" width="610" height="210" rx="31.5" ry="31.5" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 783px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doGlobalBegin</div></div></div></foreignObject><text x="1995" y="795" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doGlobalBegin</text></switch></g><rect x="1710" y="806" width="570" height="160" rx="11.2" ry="11.2" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 813px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DefaultCore.begin<br /><ol><li>GlobalSession.createGlobalSession创建全局事务session</li><li>添加session生命周期监听器，类型为SessionManager的监听器，如果使用的存储时DB,则监听器为DataBaseSessionManager。</li><li>GlobalSession执行begin，开启全局事务。设置status为begin，设置开始时间属性，调用生命周期监听器的onBegin方法即此时会执行DataBaseSessinoManage的insertGlobalTransactionDO方法，将globalSession存储到DB中。</li><li>发送全局事务开始事件GlobalTransactionEvent</li><li>返回全局事务的xid到TM</li></ol></div></div></div></foreignObject><text x="1712" y="825" fill="#000000" font-family="Helvetica" font-size="12px">DefaultCore.begin...</text></switch></g><rect x="1690" y="1061" width="610" height="210" rx="31.5" ry="31.5" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1068px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doBranchRegister</div></div></div></foreignObject><text x="1995" y="1080" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doBranchRegister</text></switch></g><rect x="1710" y="1096" width="570" height="160" rx="11.2" ry="11.2" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1103px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchRegister<br /><ol><li>获取根据xId获取GlobalSession</li><li>检查GlobalSession的状态</li><li>添加生命周期监听器</li><li>创建branchSession，设置xid，transactionId，branchId，branchType，resourceId，lockKeys</li><li>branchSessionLock，分支加锁，行级锁。假锁成功才会继续执行。</li><li>globalSession.addBranch,分支事务落库，设置branchSession状态为registered，添加branchSession到属性集合branchSessions中。</li><li>返回branchSession的branchId。</li></ol></div></div></div></foreignObject><text x="1712" y="1115" fill="#000000" font-family="Helvetica" font-size="12px">branchRegister...</text></switch></g><rect x="454.69" y="1896" width="258.12" height="60" rx="9" ry="9" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1903px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">report<br />发送BranchReportRequest请求<br />上报分支事务第一阶段执行成功。</div></div></div></foreignObject><text x="584" y="1915" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">report...</text></switch></g><rect x="1690" y="1356" width="610" height="160" rx="24" ry="24" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1363px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doBranchReport(默认不发送该类型消息)</div></div></div></foreignObject><text x="1995" y="1375" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doBranchReport(默认不发送该类型消息)</text></switch></g><rect x="1710" y="1386" width="570" height="110" rx="7.7" ry="7.7" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1393px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">branchReport<br /><ol><li>获取globalSession，且globalSession包含branchSession信息。</li><li>根据分支branchId从globalSession中获取branchSession</li><li>添加生命周期监听器</li><li>更新branchSession状态为PhaseOne_Done,库中状态同步更新。</li></ol></div></div></div></foreignObject><text x="1712" y="1405" fill="#000000" font-family="Helvetica" font-size="12px">branchReport...</text></switch></g><rect x="454.69" y="1976" width="258.12" height="60" rx="9" ry="9" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 256px; height: 1px; padding-top: 1983px; margin-left: 456px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">reset<br />xid,branchId,lockKeysBuffer,<br />sqlUndoItemsBuffer属性置空</div></div></div></foreignObject><text x="584" y="1995" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">reset...</text></switch></g><rect x="1690" y="1586" width="610" height="180" rx="27" ry="27" fill="#6a00ff" stroke="#3700cc" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 608px; height: 1px; padding-top: 1593px; margin-left: 1691px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #ffffff; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">doGlobalCommit</div></div></div></foreignObject><text x="1995" y="1605" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">doGlobalCommit</text></switch></g><rect x="1710" y="1616" width="570" height="120" rx="8.4" ry="8.4" fill="#e3c800" stroke="#b09500" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 568px; height: 1px; padding-top: 1623px; margin-left: 1712px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">commit<br /><ol><li>根据xid获取globalSession</li><li>添加生命周期监听器</li><li>设置globalSession的active属性为false，释放所有branchSession的锁</li><li>更改globalSession的状态为committing</li><li>如果是AT模式异步提交全局事务</li><li>返回全局事务提交状态</li></ol></div></div></div></foreignObject><text x="1712" y="1635" fill="#000000" font-family="Helvetica" font-size="12px">commit...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>